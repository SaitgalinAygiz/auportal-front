import React, {useContext, useState} from 'react'
import {modalContext} from "contexts/modalContext";
import {CurrentUserContext} from "contexts/currentUser"
import RegistrationRules from './registrationRules'
import axios from 'axios'
import {serverUrl} from "../../utils";
import useLocalStorage from "hooks/useLocalStorage";

const SmsCodeConfirm = () => {
    let {modalContent, handleModal, modal} = useContext(modalContext)
    const [currentUserState] = useContext(CurrentUserContext)
    const [code, setCode] = useState('')
    const [token] = useLocalStorage('token')

    const smsCodeConfirmUrl = `${serverUrl}/auth/smsCodeConfirm`

    const handleClose = event => {
        event.preventDefault()
        handleModal()
    }

    const handleSubmit = event => {
        event.preventDefault()

        const headers = {
            'Content-Type': 'application/json',
            'Authorization': token ? `Bearer ${token}` : ''
        }

        axios.post(smsCodeConfirmUrl, {smsCode: code}, {headers: headers})
            .then(response => {
                console.log(response)
                handleModal(<RegistrationRules/>, true)
            })
            .catch(err => {
                console.log(err)
            })
    }

    return (
        <div>
            <div className="modal modal_tel" style={{display: 'flex'}}>
                <div className="modal_bg"/>
                <div className="modal_box" style={{maxWidth: '610px'}}>
                    <img onClick={handleClose} className="close mod_close" src="/img/close.svg" alt={"close"}/>
                    <h2>Подтверждение номера телефона</h2>
                    <p>На указаный Вами номер <span className="red">{currentUserState.phone}</span> было отправлено SMS
                        с
                        кодом подтверждения</p>
                    <input
                        type="tel"
                        maxLength={6}
                        minLength={6}
                        placeholder="Введите код подтверждения"
                        onChange={event => {
                            setCode(event.target.value)
                        }}
                    />
                    <a onClick={handleSubmit} className="hover2">{'Подтвердить'}</a>
                </div>
            </div>
        </div>
    )
}

export default SmsCodeConfirm
